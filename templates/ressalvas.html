<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Ressalvas</title>
    <style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #ffffff;
}
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #000;
            padding: 6px;
        }
input[type=text] {
    width: 95%;
}
.topbar { background: linear-gradient(to right, #007bff, #0725d3); color: white; padding: 40px; display: flex; justify-content: space-between; align-items: center; position: relative; }
.logo { position: absolute; height: 35%; top: -13%; left: 20px; z-index: 1; }
.address { position: relative; text-align: right; top: -20px; font-size: 12px; color: white; flex: 1; margin-right: 5%; }
.contact-info { position: relative; top: -20px; text-align: right; font-size: 12px; color: white; }
.contact-info a { color: white; text-decoration: none; font-size: 12px; margin-left: 5px; }
.contact-info a:first-child { margin-left: 0; }
.contact-info a:hover { text-decoration: underline; }
.navigation { position: relative; top: -20px; text-align: right; font-size: 12px; color: white; }
.navigation a { color: white; text-decoration: none; margin-left: 5px; }
.navigation a:first-child { margin-left: 0; }
.navigation a:hover { text-decoration: underline; }
</style>
</head>
<body>
    <!-- LOGO (AGORA COM url_for) -->
    <img src="{{ url_for('static', filename='logo_fleximedical.png') }}" class="logo">

    <div class="topbar">
        <div class="address">
            R. JosÃ© AntÃ´nio Valadares, 285 â€“ Vila Liviero<br>
            SÃ£o Paulo â€“ SP. CEP: 04185-020
        </div>
        <div class="contact-info">
            comercial@soukure.com.br<br>
            <strong>(11) 2372-7444</strong>
        </div>
        <div class="navigation">
            <a href="{{ url_for('home') }}">PAGINA INICIAL</a> |
            <a href="{{ url_for('termo') }}">TERMO DE ACEITE</a> |
            <a href="{{ url_for('ressalvas') }}">RESSALVA</a> |
            <a href="{{ url_for('nps') }}">NPS</a>
        </div>
    </div>

    <h2>Ressalvas Encontradas</h2>
    <form method="POST" enctype="multipart/form-data">
        <table>
            <tr>
                <th>Item</th>
                <th>DescriÃ§Ã£o da Ressalva</th>
                <th>Prazo do Reparo</th>
                <th>AprovaÃ§Ã£o</th>
            </tr>
            {% for i in range(7) %}
            <tr>
                <td><input type="text" name="item{{ i }}"></td>
                <td><input type="text" name="desc{{ i }}"></td>
                <td><input type="text" name="prazo{{ i }}"></td>
                <td><input type="text" name="aprov{{ i }}"></td>
            </tr>
            {% endfor %}
        </table>
        <p>Foto das Ressalvas:</p>
        <input type="file" name="foto_ressalvas" id="foto_ressalvas" accept="image/*" style="display: none;">
        <button type="button" onclick="openCamera('foto_ressalvas')" style="padding:10px 20px; background:#0066cc; color:#fff; border:none; border-radius:8px;">ðŸ“· Abrir CÃ¢mera</button>
        <br><br>
        <p>APROVAÃ‡ÃƒO FINAL APÃ“S AS RESSALVAS REALIZADAS:</p>
        <p>Representante:<br><input type="text" name="Representante"></p>
        <p>CPF:<br><input type="text" name="CPF"></p>
        <br><br>
        <button type="submit" style="padding:10px 20px; background:#0066cc; color:#fff; border:none; border-radius:8px;">Salvar Ressalvas</button>
    </form>

    <!-- Modal for Camera -->
    <div id="cameraModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 1000;">
        <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
            <video id="modalVideo" autoplay style="width: 100%; max-width: 400px;"></video>
            <br><br>
            <button onclick="capturePhoto()" style="padding:10px 20px; background:#28a745; color:#fff; border:none; border-radius:8px;">Capturar</button>
            <button onclick="closeCamera()" style="padding:10px 20px; background:#dc3545; color:#fff; border:none; border-radius:8px;">Fechar</button>
        </div>
    </div>

    <script>
        let cameraStream;
        let activeField;

        async function openCamera(field) {
            activeField = field;

            document.getElementById("cameraModal").style.display = "flex";

            cameraStream = await navigator.mediaDevices.getUserMedia({
                video: {
                    facingMode: "environment",
                    width: { ideal: 1920 },
                    height: { ideal: 1080 }
                }
            });

            const video = document.getElementById("modalVideo");
            video.srcObject = cameraStream;
            video.play();
        }

        function capturePhoto() {
            const video = document.getElementById("modalVideo");
            const canvas = document.createElement("canvas");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(video, 0, 0);

            canvas.toBlob((blob) => {
                const file = new File([blob], "photo.jpg", { type: "image/jpeg" });
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                document.getElementById(activeField).files = dataTransfer.files;
                closeCamera();
            });
        }

        function closeCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
            }
            document.getElementById("cameraModal").style.display = "none";
        }
    </script>
</body>
</html>
